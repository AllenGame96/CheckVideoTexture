# 更新说明 - 手动选帧版本

## 🎉 最新改进（v2.0）

根据反馈，将自动抽帧改为**用户手动选择4帧**，提供更灵活和准确的检测方式！

## 📋 版本演进

### v1.0 - 首帧标注版（已废弃）
1. 上传视频
2. 在首帧标注地板、障碍、背景
3. 设置抽帧率
4. 开始分析（抽取多帧）
5. 查看结果

**问题**：只在首帧标注，假设所有帧的区域位置相同，不够准确。

### v1.5 - 自动抽帧版（已废弃）
1. 上传视频
2. 自动抽取4帧（在视频的 20%, 40%, 60%, 80% 位置）
3. 在4帧上分别标注地板、障碍、背景
4. 开始分析
5. 查看结果

**问题**：自动抽帧位置固定，可能错过关键场景，不够灵活。

### v2.0 - 手动选帧版（当前版本）✨
1. **上传视频**
2. **手动选择4帧**（播放视频，暂停后捕获）
3. **在4帧上分别标注**地板、障碍、背景
4. **开始分析**
5. **查看结果**

**优势**：
- ✅ 用户自主选择关键帧，更灵活
- ✅ 可以根据视频内容选择最有代表性的帧
- ✅ 适应不同类型的视频（固定镜头、移动镜头、场景切换等）
- ✅ 每帧独立标注，适应画面变化
- ✅ 找出最差帧，确保整个视频都符合标准

## 🎯 新功能详解

### 1. 视频播放器
- 上传视频后显示完整的视频播放器
- 支持播放、暂停、快进、快退
- 支持拖动进度条跳转
- 显示当前播放时间

### 2. 手动捕获帧
- 播放视频到需要检测的位置
- 暂停视频
- 点击"📸 捕获当前帧"按钮
- 实时显示已选择的帧数（0/4 → 4/4）

### 3. 帧预览和管理
- 已选择的帧显示在预览区
- 每帧显示缩略图、帧号和时间戳
- 点击帧右上角的"×"可删除该帧
- 选满4帧后自动禁用捕获按钮

### 4. 4帧网格显示
- 点击"开始标注"后显示2x2网格布局
- 点击任意帧可切换为当前帧
- 当前帧有蓝色边框高亮
- 每帧显示帧号标签

### 5. 多帧标注系统
- 每帧独立标注地板、障碍、背景
- 当前帧信息实时显示
- 标注进度追踪（显示每帧的完成状态）
- 支持帧间导航（上一帧/下一帧按钮）

### 6. 智能分析
- 分析全部4帧的明度数据
- 找出明度差最小的帧（最差帧）
- 基于最差帧判断是否合格
- 确保整个视频都符合标准

## 📝 使用步骤

### 步骤1：上传视频
- 点击上传区域选择视频文件
- 视频加载后显示播放器

### 步骤2：选择4帧
1. 播放视频，观察画面
2. 在需要检测的位置暂停
3. 点击"📸 捕获当前帧"按钮
4. 重复步骤1-3，直到选择4帧
5. 已选择的帧会显示在下方预览区

### 步骤3：开始标注
- 选满4帧后，点击"开始标注"按钮
- 进入标注界面

### 步骤4：标注第1帧
1. 第1帧默认选中（蓝色边框）
2. 点击"标注地板"，在帧上拖动框选
3. 点击"标注障碍"，框选障碍区域
4. 点击"标注背景"，框选背景区域

### 步骤5：标注第2-4帧
1. 点击第2帧（或点击"下一帧"按钮）
2. 重复标注地板、障碍、背景
3. 依次完成第3帧、第4帧的标注

### 步骤6：开始分析
- 确保所有4帧都显示"✅ 已完成"
- 点击"开始分析"按钮
- 等待分析完成

### 步骤7：查看结果
- 查看总体合格状态
- 查看明度值和明度差
- 查看最差帧的可视化

## 💡 使用技巧

### 选帧技巧
1. **均匀分布**：如果视频场景变化不大，可以在开头、1/3、2/3、结尾位置选帧
2. **关键场景**：如果视频有明显的场景切换，选择每个场景的典型帧
3. **光照变化**：选择不同光照条件下的帧，确保全面检测
4. **避免过渡**：不要选择场景切换时的过渡帧或模糊帧
5. **删除重选**：如果选错了，点击帧右上角的"×"删除，重新选择

### 标注技巧
1. **快速切换帧**：直接点击帧图片，比使用按钮更快
2. **标注顺序**：建议按帧号顺序标注（1→2→3→4）
3. **区域选择**：每帧可以标注不同位置，根据画面调整
4. **进度检查**：随时查看下方的标注进度，确保不遗漏
5. **错误修正**：如果标注错误，切换到该帧，点击"清除当前帧标注"

## 🔧 技术改进

### 代码变更
- 移除了自动抽帧相关代码（`extractFourFrames`、`captureFrame`、`updateExtractProgress`）
- 新增视频播放器控制逻辑
- 新增手动捕获帧功能（`captureCurrentFrame`）
- 新增帧预览和管理功能（`updateFramesPreview`、`removeFrame`）
- 新增时间格式化函数（`formatTime`）

### 界面变更
- 移除了"抽帧进度"界面
- 新增视频播放器（`<video>` 元素）
- 新增"捕获当前帧"按钮
- 新增帧预览区域（显示已选择的帧）
- 新增"开始标注"按钮

### 样式优化
- 新增视频播放器样式
- 新增帧预览卡片样式
- 新增删除按钮样式
- 优化响应式布局

## 📊 界面变化

### 新增元素（v2.0）
- 视频播放器（支持完整的播放控制）
- "捕获当前帧"按钮（显示已选帧数）
- 帧预览区域（显示已选择的4帧）
- 帧删除按钮（每帧右上角的"×"）
- "开始标注"按钮

### 移除元素（v2.0）
- 自动抽帧进度条
- 抽帧进度文本

### 保留元素
- 4帧网格显示区域
- 当前帧号指示器
- 帧导航按钮（上一帧/下一帧）
- 标注进度面板（显示每帧完成状态）

## 🎨 视觉优化

- 2x2 网格布局，更直观
- 当前帧蓝色高亮边框
- 每帧左上角显示帧号
- 标注完成状态用绿色标记
- 响应式设计，适配不同屏幕

## 📖 文档更新

已同步更新以下文档：
- ✅ README.md
- ✅ 使用指南.md
- ✅ 本更新说明

## 🚀 立即体验

直接打开 `index.html` 文件即可体验新版本！

新流程更加科学合理，能够更准确地检测视频的明度合规性。

