# 视频亮度检测工具

一个用于检测游戏录制视频中障碍、地板、背景明度差是否达标的 Web 工具。

## 功能特点

- ✅ **视频上传**: 支持常见视频格式
- ✅ **手动选帧**: 用户自主选择视频中的4个关键帧进行检测
- ✅ **多帧标注**: 在4帧上分别标注地板、障碍、背景区域
- ✅ **明度计算**: 使用感知亮度公式计算区域明度中位数
- ✅ **合规检测**: 自动判断明度差是否达标
- ✅ **最差帧检测**: 找出4帧中明度差最小的帧
- ✅ **可视化结果**: 显示灰度预览图和标注区域

## 检测标准

根据产品需求文档（PRD），工具会检测以下明度差标准：

| 对比区域 | 合格标准 |
|---------|---------|
| 障碍 ↔ 地板 | ≥ 10% |
| 地板 ↔ 背景 | ≥ 20% |

## 使用方法

### 1. 打开工具

直接在浏览器中打开 `index.html` 文件即可使用，无需安装任何依赖。

```bash
# 方法1: 直接双击 index.html 文件

# 方法2: 使用本地服务器（推荐）
# 如果安装了 Python
python -m http.server 8000

# 如果安装了 Node.js
npx serve
```

然后在浏览器中访问 `http://localhost:8000`

### 2. 选择4帧

上传视频后，会显示视频播放器：

1. 播放视频，找到需要检测的位置
2. 点击"📸 捕获当前帧"按钮（会自动暂停并捕获）
3. 重复步骤1-2，直到选择了4帧

> 💡 提示：选择有代表性的4个时间点，覆盖视频的不同场景。点击捕获按钮会自动暂停视频。

### 3. 标注区域

选择4帧后，点击"开始标注"，在4帧上分别标注三个区域：

1. 点击某一帧使其成为当前帧
2. **地板 (Floor)**: 点击"标注地板"按钮，在该帧上拖动鼠标框选地板区域
3. **障碍 (Obstacle)**: 点击"标注障碍"按钮，框选障碍物区域
4. **背景 (Background)**: 点击"标注背景"按钮，框选背景区域
5. 切换到下一帧，重复步骤2-4

> 💡 提示：需要在全部4帧上完成标注（共12次标注）

### 4. 开始分析

所有帧标注完成后，点击"开始分析"按钮。工具会：

- 计算4帧中各区域的明度值
- 找出明度差最小的帧（最差帧）
- 判断是否符合标准

### 5. 查看结果

分析完成后，会显示：

- **总体状态**: ✅ 合格 / ❌ 不合格
- **明度值**: 地板、障碍、背景的平均明度值（0-255）
- **明度差**: 障碍↔地板、地板↔背景的明度差百分比
- **最差帧**: 显示明度差最小的帧及其时间戳
- **可视化**: 灰度预览图，标注区域高亮显示

## 技术实现

### 明度计算公式

采用基于人眼感知的亮度模型：

```
Value = 0.2126 × R + 0.7152 × G + 0.0722 × B
```

- R / G / B 范围：0–255
- Value 输出范围：0–255

### 区域代表值

使用**中位数（Median）**作为区域代表值，避免局部高亮或阴影干扰。

### 明度差计算

```
明度差 (%) = |V1 - V2| / 255 × 100%
```

## 项目结构

```
CheckVideoNew/
├── index.html      # 主页面
├── styles.css      # 样式文件
├── app.js          # 核心逻辑
├── README.md       # 说明文档
└── 需求            # 产品需求文档
```

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 注意事项

1. 建议使用较短的视频进行测试（< 1分钟）
2. 用户需要手动选择4个关键帧（播放视频，暂停后捕获）
3. 选择的4帧应该覆盖视频的不同场景和时间点
4. 需要在每一帧上分别标注地板、障碍、背景（共12次标注）
5. 标注区域时尽量选择有代表性的区域
6. 每帧的标注区域可以不同，根据画面变化调整

## 开发者

根据需求文档开发，用于游戏视频明度合规性检测。

