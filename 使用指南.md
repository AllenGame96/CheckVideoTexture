# 视频亮度检测工具 - 使用指南

## 快速开始

### 方法1：直接打开（推荐）

1. 双击 `index.html` 文件
2. 浏览器会自动打开工具界面

### 方法2：使用本地服务器

如果直接打开遇到问题，可以使用本地服务器：

```bash
# 使用 Python（如果已安装）
python -m http.server 8000

# 使用 Node.js（如果已安装）
npx serve

# 使用 PHP（如果已安装）
php -S localhost:8000
```

然后访问：`http://localhost:8000`

## 使用步骤

### 步骤 1：上传视频

1. 点击上传区域的 📁 图标
2. 选择要检测的视频文件
3. 支持的格式：MP4, MOV, AVI, WebM 等

**建议**：
- 使用较短的视频（< 1分钟）进行首次测试
- 视频分辨率不要太高（720p 或 1080p 即可）

### 步骤 2：手动选择4帧

视频上传后，会显示视频播放器。你需要手动选择4个关键帧：

**操作步骤**：
1. 播放视频，观察画面
2. 在需要检测的位置，点击"📸 捕获当前帧"按钮
3. 视频会自动暂停并捕获当前帧
4. 重复步骤1-3，直到选择了4帧

**选帧建议**：
- ✅ 选择有代表性的时间点（例如：开头、中间、结尾等）
- ✅ 覆盖视频的不同场景和光照条件
- ✅ 选择画面清晰、典型的帧
- ✅ 无需手动暂停，点击捕获按钮会自动暂停
- ❌ 避免选择过渡帧或模糊帧

**已选帧管理**：
- 已选择的帧会显示在下方预览区
- 每帧显示帧号和时间戳
- 点击帧右上角的"×"可删除该帧
- 选满4帧后，"捕获当前帧"按钮会禁用

### 步骤 3：在4帧上标注区域

选择4帧后，点击"开始标注"按钮，工具会显示4帧的网格视图（2x2布局）。你需要在**每一帧**上分别标注三个区域。

**操作流程**：
1. 点击某一帧，使其成为当前帧（会有蓝色边框高亮）
2. 点击标注按钮（地板/障碍/背景）
3. 在该帧上拖动鼠标框选区域
4. 完成后切换到下一帧，重复标注

**帧导航**：
- 点击帧图片可直接切换
- 使用"上一帧"/"下一帧"按钮切换
- 当前帧号显示在界面上

#### 3.1 标注地板（Floor）

1. 选中要标注的帧（点击帧图片）
2. 点击绿色按钮 **"标注地板 (Floor)"**
3. 在该帧上按住鼠标左键拖动，框选地板区域
4. 松开鼠标完成标注
5. 地板区域会显示为绿色半透明矩形

**地板定义**：
- 角色（球）下方、可行走的方格平台
- 连续、规则的平面区域
- 位于画面中部或偏下

#### 3.2 标注障碍（Obstacle）

1. 点击橙色按钮 **"标注障碍 (Obstacle)"**
2. 在当前帧上框选障碍物区域
3. 障碍区域会显示为橙色半透明矩形

**障碍定义**：
- 位于地板上方的物体
- 会影响玩家判断或路径
- 例如：悬浮物、植物、柱状物、宝石等
- **不包含角色本体**

#### 3.3 标注背景（Background）

1. 点击蓝色按钮 **"标注背景 (Background)"**
2. 在当前帧上框选背景区域
3. 背景区域会显示为蓝色半透明矩形

**背景定义**：
- 除地板、障碍、角色以外的所有区域
- 中远景、环境装饰、空间背景

#### 标注技巧

- ✅ **每一帧都需要标注**：4帧 × 3个区域 = 共12次标注
- ✅ 选择有代表性的区域（不需要框选整个区域）
- ✅ 避开阴影和高光区域
- ✅ 每个区域选择颜色均匀的部分
- ❌ 不要标注角色（球）本身
- 💡 如果当前帧标注错误，点击 **"清除当前帧标注"** 重新标注该帧
- 💡 界面下方会显示每帧的完成状态（✅ 已完成 / 未完成）

### 步骤 4：开始分析

1. 确保所有4帧都已完成标注（每帧都标注了地板、障碍、背景）
2. 点击 **"开始分析"** 按钮（只有全部标注完成后才能点击）
3. 等待分析完成：
   - 工具会分析4帧的明度数据
   - 显示进度条
   - 分析速度很快（通常几秒内完成）

### 步骤 5：查看结果

分析完成后，会显示详细的检测结果：

#### 5.1 总体状态

- ✅ **合格**：所有明度差都达标
- ❌ **不合格**：至少有一项明度差不达标

#### 5.2 明度值

显示三个区域的平均明度值（基于4帧的平均，0-255）：
- 地板 (Floor)
- 障碍 (Obstacle)
- 背景 (Background)

#### 5.3 明度差检测

| 对比项 | 标准 | 结果 |
|-------|------|------|
| 障碍 ↔ 地板 | ≥ 10% | 显示实际百分比和合格状态 |
| 地板 ↔ 背景 | ≥ 20% | 显示实际百分比和合格状态 |

**注意**：显示的是4帧中**最差帧**的明度差数据，确保即使在最差情况下也符合标准。

#### 5.4 最差帧信息

- **时间戳**：4帧中明度差最小的帧的时间位置和帧号
- **可视化预览**：
  - 显示该帧的灰度图像
  - 标注区域用彩色边框高亮显示
  - 绿色 = 地板，橙色 = 障碍，蓝色 = 背景

### 步骤 6：重新检测

点击 **"重新检测"** 按钮可以返回首页，上传新视频。

## 检测标准说明

### 明度计算公式

工具使用基于人眼感知的亮度模型：

```
明度值 (Value) = 0.2126 × R + 0.7152 × G + 0.0722 × B
```

- R、G、B：红、绿、蓝通道值（0-255）
- Value：明度值（0-255）

### 区域代表值

使用 **中位数（Median）** 而非平均值，原因：
- 避免局部高亮（如反光）的干扰
- 避免局部阴影的干扰
- 更能代表区域的整体明度

### 明度差计算

```
明度差 (%) = |明度值1 - 明度值2| / 255 × 100%
```

### 判定标准

- **障碍 ↔ 地板**：明度差 ≥ 10% 为合格
- **地板 ↔ 背景**：明度差 ≥ 20% 为合格
- **总体合格**：两项都达标

## 常见问题

### Q1: 为什么要手动选择4帧？

**原因**：
- 用户最了解视频内容，可以选择最有代表性的帧
- 不同视频的关键场景位置不同，自动抽帧可能错过重要场景
- 手动选择更灵活，可以根据实际需求调整

### Q2: 如何选择合适的4帧？

**建议**：
- 选择视频中有代表性的时间点
- 覆盖不同的场景和光照条件
- 如果视频场景变化不大，可以均匀分布（开头、1/3、2/3、结尾）
- 如果视频有明显的场景切换，选择每个场景的典型帧

### Q3: 为什么要在4帧上分别标注？

**原因**：
- 视频不同时间点的画面可能有变化（光照、位置等）
- 在多个时间点检测可以更全面地评估视频质量
- 找出最差的情况，确保整个视频都符合标准

### Q4: 标注区域应该多大？

**建议**：
- 不需要框选整个区域
- 选择 50-200 像素的矩形即可
- 重要的是选择有代表性的区域
- 每一帧的标注区域可以不同（根据画面变化调整）

### Q5: 4帧的标注区域必须一样吗？

**不需要**：
- 每一帧可以独立标注不同的区域
- 根据该帧的实际画面选择最合适的区域
- 例如：如果障碍物在移动，每帧可以标注不同位置

### Q6: 结果显示不合格，怎么办？

**分析原因**：
1. 查看最差帧的可视化图像
2. 检查标注区域是否准确
3. 确认游戏画面的明度设计

**可能的解决方案**：
- 调整游戏的颜色设计
- 增加障碍物和地板的对比度
- 调整背景的明暗度

## 技术支持

如有问题或建议，请查看 `README.md` 文件或联系开发团队。

